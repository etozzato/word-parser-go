# -*- encoding : utf-8 -*-
require_relative './base'

class Cloud < Base
  attr_accessor :stop_words, :word_cloud, :heaviest_word, :responses, :comments
  ffi_lib './word-parser.so'

  attach_function :parseWords, [:pointer, :pointer], :string

  def initialize(responses, comments, stop_words)
    self.responses  = responses
    self.comments   = comments
    self.stop_words = stop_words.join("*")

    parse_words
  end

  private

  def parse_words
    self.word_cloud = JSON.parse(parseWords(sentences.join("*"), stop_words)) rescue []
    self.heaviest_word = word_cloud.first['Text'] if word_cloud.any?
  end

  #  PRODUCTION
  # def sentences
  #   (responses + comments).map(&:text)
  # end

  #  TEST
  def sentences
    (responses + comments).map{|item| item[:text]}
  end

end

stop_words = ["january", "february", "march", "april", "may", "june", "july", "august", "september", "october", "november", "december", "monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "-", "_", "--", "''", "we've", "we'll", "we're", "who'll", "who've", "who's", "you'll", "you've", "you're", "i'll", "i've", "i'm", "i'd", "he'll", "he'd", "he's", "she'll", "she'd", "she's", "it'll", "it'd", "it's", "they've", "they're", "they'll", "didn't", "don't", "can't", "won't", "isn't", "wasn't", "couldn't", "should't", "wouldn't", "ve", "ll", "re", "th", "rd", "st", "doing", "allow", "examining", "using", "during", "within", "across", "among", "whether", "especially", "without", "actually", "another", "am", "because", "cannot", "the", "of", "to", "and", "a", "in", "is", "it", "you", "that", "he", "was", "for", "on", "are", "with", "as", "I", "his", "they", "be", "at", "one", "have", "this", "from", "or", "had", "by", "hot", "word", "but", "what", "some", "we", "yet", "can", "out", "other", "were", "all", "there", "when", "up", "use", "your", "how", "said", "an", "each", "she", "which", "do", "their", "time", "if", "will", "shall", "way", "about", "many", "then", "themR", "write", "would", "like", "so", "these", "her", "long", "make", "thing", "see", "him", "two", "has", "look", "more", "day", "could", "go", "come", "did", "no", "most", "my", "over", "know", "than", "call", "first", "who", "may", "down", "side", "been", "now", "find", "any", "new", "part", "take", "get", "place", "made", "where", "after", "back", "little", "only", "came", "show", "every", "good", "me", "our", "under", "upon", "very", "through", "just", "great", "say", "low", "cause", "much", "mean", "before", "move", "right", "too", "same", "tell", "does", "set", "three", "want", "well", "also", "small", "end", "put", "hand", "large", "add", "here", "must", "big", "high", "such", "why", "ask", "men", "went", "kind", "need", "try", "us", "again", "near", "should", "still", "between", "never", "last", "let", "though", "might", "saw", "left", "late", "run", "don't", "while", "close", "few", "seem", "next", "got", "always", "those", "both", "often", "thus", "won't", "not", "into", "inside", "its", "makes", "tenth", "trying", "i", "me", "my", "myself", "we", "us", "our", "ours", "ourselves", "you", "your", "yours", "yourself", "yourselves", "he", "him", "his", "himself", "she", "her", "hers", "herself", "it", "its", "itself", "they", "them", "their", "theirs", "themselves", "what", "which", "who", "whom", "this", "that", "these", "those", "am", "is", "are", "was", "were", "be", "been", "being", "have", "has", "had", "having", "do", "does", "did", "doing", "will", "would", "shall", "should", "can", "could", "may", "might", "must", "ought", "i'm", "you're", "he's", "she's", "it's", "we're", "they're", "i've", "you've", "we've", "they've", "i'd", "you'd", "he'd", "she'd", "we'd", "they'd", "i'll", "you'll", "he'll", "she'll", "we'll", "they'll", "isn't", "aren't", "wasn't", "weren't", "hasn't", "haven't", "hadn't", "doesn't", "don't", "didn't", "won't", "wouldn't", "shan't", "shouldn't", "can't", "cannot", "couldn't", "mustn't", "let's", "that's", "who's", "what's", "here's", "there's", "when's", "where's", "why's", "how's", "daren't", "needn't", "oughtn't", "mightn't", "a", "an", "the", "and", "but", "if", "or", "because", "as", "until", "while", "of", "at", "by", "for", "with", "about", "against", "between", "into", "through", "during", "before", "after", "above", "below", "to", "from", "up", "down", "in", "out", "off", "over", "under", "again", "further", "then", "once", "here", "there", "when", "where", "why", "how", "all", "any", "both", "each", "few", "more", "most", "other", "some", "such", "nor", "not", "only", "own", "same", "so", "than", "too", "very", "one", "every", "least", "less", "many", "now", "ever", "never", "say", "says", "said", "also", "get", "go", "goes", "just", "made", "make", "put", "see", "seen", "whether", "like", "well", "back", "even", "still", "way", "take", "since", "another", "however", "two", "three", "four", "five", "first", "second", "new", "old", "high", "long", ":", ";", "%", ",", "&"]

responses = [{:id=>551, :text=>"Today we are entering a new era for our country and its people"}, {:id=>419, :text=>" Today we celebrate not the victory of a party, but a victory for all the people of South Africa"}, {:id=>958, :text=>"  Our country has arrived at a decision"}, {:id=>555, :text=>" Among all the parties that contested the elections, the overwhelming majority of South Africans have mandated the African National Congress to lead our country into the future"}, {:id=>239, :text=>" The South Africa we have struggled for, in which all our people, be they African, Coloured, Indian or White, regard themselves as citizens of one nation is at hand"}, {:id=>414, :text=>"  Perhaps it was history that ordained that it be here, at the Cape of Good Hope that we should lay the foundation stone of our new nation"}, {:id=>3, :text=>" For it was here at this Cape, over three countries ago, that there began the fateful convergence of the peoples of Africa, Europe and Asia on these shores"}, {:id=>675, :text=>"  It was to this peninsula that the patriots, among them many princes and scholars, of Indonesia were dragged in chains"}, {:id=>573, :text=>" It was on the sandy plains of this peninsula that first battles of the epic wars of resistance were fought"}, {:id=>485, :text=>"  When we look out across Table Bay, the horizon is dominated by Robben Island, whose infamy as a dungeon built to stifle the spirit of freedom is as old as colonialism in South Africa"}, {:id=>893, :text=>" For three centuries that island was seen as a place to which outcasts can be banished"}, {:id=>27, :text=>" The names of those who were incarcerated on Robben Island is a roll call of resistance fighters and democrats spanning over three centuries"}, {:id=>316, :text=>" If indeed this is a Cape of Good Hope, that hope owes much to the spirit of that legion of fighters and others of their calibre"}, {:id=>891, :text=>"  We have fought for a democratic constitution since the 1880s"}, {:id=>227, :text=>" Ours has been a quest for a constitution freely adopted by the people of South Africa, reflecting their wishes and their aspirations"}, {:id=>248, :text=>" The struggle for democracy has never been a matter pursued by one race, class, religious community or gender among South Africans"}, {:id=>46, :text=>" In honouring those who fought to see this day arrive, we honour the best sons and daughters of all our people"}, {:id=>400, :text=>" We can count amongst them Africans, Coloureds, Whites, Indians, Muslims, Christians, Hindus, Jews - all of them united by a common vision of a better life for the people of this country"}, {:id=>458, :text=>"  It was that vision that inspired us in 1923 when we adopted the first ever Bill of Rights in this country"}, {:id=>200, :text=>" That same vision spurred us to put forward the African Claims in 1946"}, {:id=>399, :text=>" It is also the founding principle of the Freedom Charter we adopted as policy in 1955, which in its very first lines, places before South Africa an inclusive basis for citizenship"}, {:id=>213, :text=>"  In the 1980s the African National Congress was still setting the pace, being the first major political formation in South Africa to commit itself firmly to a Bill of Rights, which we published in November 1990"}, {:id=>51, :text=>" These milestones give concrete expression to what South Africa can become"}, {:id=>596, :text=>" They speak of a constitutional, democratic, political order in which, regardless of colour, gender, religion, political opinion or sexual orientation, the law will provide for the equal protection of all citizens"}, {:id=>116, :text=>"  They project a democracy in which the government, whomever that government may be, will be bound by a higher set of rules, embodied in a constitution, and will not be able govern the country as it pleases"}, {:id=>320, :text=>"  Democracy is based on the majority principle"}, {:id=>186, :text=>" This is especially true in a country such as ours where the vast majority have been systematically denied their rights"}, {:id=>147, :text=>" At the same time, democracy also requires that the rights of political and other minorities be safeguarded"}, {:id=>566, :text=>"  In the political order we have established there will regular, open and free elections, at all levels of government - central, provincial and municipal"}, {:id=>314, :text=>" There shall also be a social order which respects completely the culture, language and religious rights of all sections of our society and the fundamental rights of the individual"}, {:id=>506, :text=>"  The task at hand on will not be easy"}, {:id=>907, :text=>" But you have mandated us to change South Africa from a country in which the majority lived with little hope, to one in which they can live and work with dignity, with a sense of self-esteem and confidence in the future"}, {:id=>980, :text=>" The cornerstone of building a better life of opportunity, freedom and prosperity is the Reconstruction and Development Programme"}, {:id=>199, :text=>"  This needs unity of purpose"}, {:id=>634, :text=>" It needs in action"}, {:id=>636, :text=>" It requires us all to work together to bring an end to division, an end to suspicion and build a nation united in our diversity"}, {:id=>787, :text=>"  The people of South Africa have spoken in these elections"}, {:id=>435, :text=>" They want change! And change is what they will get"}, {:id=>686, :text=>" Our plan is to create jobs, promote peace and reconciliation, and to guarantee freedom for all South Africans"}, {:id=>955, :text=>" We will tackle the widespread poverty so pervasive among the majority of our people"}, {:id=>420, :text=>" By encouraging investors and the democratic state to support job creating projects in which manufacturing will play a central role we will try to change our country from a net exporter of raw material to one that exports finished products through beneficiation"}, {:id=>333, :text=>"  The government will devise policies that encourage and reward productive enterprise among the disadvantaged communities - African, Coloured and Indian"}, {:id=>638, :text=>" By easing credit conditions we can assist them to make inroads into the productive and manufacturing spheres and breakout of the small-scale distribution to which they are presently confined"}, {:id=>466, :text=>"  To raise our country and its people from the morass of racism and apartheid will require determination and effort"}, {:id=>183, :text=>" As a government, the ANC will create a legal framework that will assist, rather than impede, the awesome task of reconstruction and development of our battered society"}, {:id=>839, :text=>"  While we are and shall remain fully committed to the spirit of a government of national unity, we are determined to initiate and bring about the change that our mandate from the people demands"}, {:id=>37, :text=>"  We place our vision of a new constitutional order for South Africa on the table not as conquerors, prescribing to the conquered"}, {:id=>343, :text=>" We speak as fellow citizens to heal the wounds of the past with the intent of constructing a new order based on justice for all"}, {:id=>923, :text=>"  This is the challenge that faces all South Africans today, and it is one to which I am certain we will all rise"}, {:id=>877, :text=>"\nToday we are entering a new era for our country and its people"}, {:id=>833, :text=>" Today we celebrate not the victory of a party, but a victory for all the people of South Africa"}, {:id=>984, :text=>"  Our country has arrived at a decision"}, {:id=>426, :text=>" Among all the parties that contested the elections, the overwhelming majority of South Africans have mandated the African National Congress to lead our country into the future"}, {:id=>792, :text=>" The South Africa we have struggled for, in which all our people, be they African, Coloured, Indian or White, regard themselves as citizens of one nation is at hand"}, {:id=>42, :text=>"  Perhaps it was history that ordained that it be here, at the Cape of Good Hope that we should lay the foundation stone of our new nation"}, {:id=>46, :text=>" For it was here at this Cape, over three countries ago, that there began the fateful convergence of the peoples of Africa, Europe and Asia on these shores"}, {:id=>371, :text=>"  It was to this peninsula that the patriots, among them many princes and scholars, of Indonesia were dragged in chains"}, {:id=>568, :text=>" It was on the sandy plains of this peninsula that first battles of the epic wars of resistance were fought"}, {:id=>114, :text=>"  When we look out across Table Bay, the horizon is dominated by Robben Island, whose infamy as a dungeon built to stifle the spirit of freedom is as old as colonialism in South Africa"}, {:id=>834, :text=>" For three centuries that island was seen as a place to which outcasts can be banished"}, {:id=>468, :text=>" The names of those who were incarcerated on Robben Island is a roll call of resistance fighters and democrats spanning over three centuries"}, {:id=>973, :text=>" If indeed this is a Cape of Good Hope, that hope owes much to the spirit of that legion of fighters and others of their calibre"}, {:id=>214, :text=>"  We have fought for a democratic constitution since the 1880s"}, {:id=>593, :text=>" Ours has been a quest for a constitution freely adopted by the people of South Africa, reflecting their wishes and their aspirations"}, {:id=>477, :text=>" The struggle for democracy has never been a matter pursued by one race, class, religious community or gender among South Africans"}, {:id=>192, :text=>" In honouring those who fought to see this day arrive, we honour the best sons and daughters of all our people"}, {:id=>353, :text=>" We can count amongst them Africans, Coloureds, Whites, Indians, Muslims, Christians, Hindus, Jews - all of them united by a common vision of a better life for the people of this country"}, {:id=>158, :text=>"  It was that vision that inspired us in 1923 when we adopted the first ever Bill of Rights in this country"}, {:id=>329, :text=>" That same vision spurred us to put forward the African Claims in 1946"}, {:id=>270, :text=>" It is also the founding principle of the Freedom Charter we adopted as policy in 1955, which in its very first lines, places before South Africa an inclusive basis for citizenship"}, {:id=>551, :text=>"  In the 1980s the African National Congress was still setting the pace, being the first major political formation in South Africa to commit itself firmly to a Bill of Rights, which we published in November 1990"}, {:id=>769, :text=>" These milestones give concrete expression to what South Africa can become"}, {:id=>699, :text=>" They speak of a constitutional, democratic, political order in which, regardless of colour, gender, religion, political opinion or sexual orientation, the law will provide for the equal protection of all citizens"}, {:id=>364, :text=>"  They project a democracy in which the government, whomever that government may be, will be bound by a higher set of rules, embodied in a constitution, and will not be able govern the country as it pleases"}, {:id=>4, :text=>"  Democracy is based on the majority principle"}, {:id=>56, :text=>" This is especially true in a country such as ours where the vast majority have been systematically denied their rights"}, {:id=>974, :text=>" At the same time, democracy also requires that the rights of political and other minorities be safeguarded"}, {:id=>558, :text=>"  In the political order we have established there will regular, open and free elections, at all levels of government - central, provincial and municipal"}, {:id=>704, :text=>" There shall also be a social order which respects completely the culture, language and religious rights of all sections of our society and the fundamental rights of the individual"}, {:id=>830, :text=>"  The task at hand on will not be easy"}, {:id=>452, :text=>" But you have mandated us to change South Africa from a country in which the majority lived with little hope, to one in which they can live and work with dignity, with a sense of self-esteem and confidence in the future"}, {:id=>874, :text=>" The cornerstone of building a better life of opportunity, freedom and prosperity is the Reconstruction and Development Programme"}, {:id=>496, :text=>"  This needs unity of purpose"}, {:id=>186, :text=>" It needs in action"}, {:id=>791, :text=>" It requires us all to work together to bring an end to division, an end to suspicion and build a nation united in our diversity"}, {:id=>121, :text=>"  The people of South Africa have spoken in these elections"}, {:id=>823, :text=>" They want change! And change is what they will get"}, {:id=>786, :text=>" Our plan is to create jobs, promote peace and reconciliation, and to guarantee freedom for all South Africans"}, {:id=>802, :text=>" We will tackle the widespread poverty so pervasive among the majority of our people"}, {:id=>141, :text=>" By encouraging investors and the democratic state to support job creating projects in which manufacturing will play a central role we will try to change our country from a net exporter of raw material to one that exports finished products through beneficiation"}, {:id=>669, :text=>"  The government will devise policies that encourage and reward productive enterprise among the disadvantaged communities - African, Coloured and Indian"}, {:id=>887, :text=>" By easing credit conditions we can assist them to make inroads into the productive and manufacturing spheres and breakout of the small-scale distribution to which they are presently confined"}, {:id=>448, :text=>"  To raise our country and its people from the morass of racism and apartheid will require determination and effort"}, {:id=>253, :text=>" As a government, the ANC will create a legal framework that will assist, rather than impede, the awesome task of reconstruction and development of our battered society"}, {:id=>419, :text=>"  While we are and shall remain fully committed to the spirit of a government of national unity, we are determined to initiate and bring about the change that our mandate from the people demands"}, {:id=>307, :text=>"  We place our vision of a new constitutional order for South Africa on the table not as conquerors, prescribing to the conquered"}, {:id=>190, :text=>" We speak as fellow citizens to heal the wounds of the past with the intent of constructing a new order based on justice for all"}, {:id=>231, :text=>"  This is the challenge that faces all South Africans today, and it is one to which I am certain we will all rise"}, {:id=>663, :text=>"\nFeatured"}]

wc = Cloud.new(responses, [], stop_words)
puts "heaviest_word: " + wc.heaviest_word.to_s
puts "word_cloud: " + wc.word_cloud.to_s
